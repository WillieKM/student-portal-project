<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revelation Bible College - Unified Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary-blue: #1E3A8A; /* Darker Blue */
            --secondary-gold: #FCD34D;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light Gray Background */
        }
        .text-primary-blue { color: var(--primary-blue); }
        .bg-primary-blue { background-color: var(--primary-blue); }
        .border-primary-blue { border-color: var(--primary-blue); }
        .text-secondary-gold { color: var(--secondary-gold); }
        .bg-secondary-gold { background-color: var(--secondary-gold); }
        .nav-link {
            transition: color 0.2s, background-color 0.2s;
            cursor: pointer;
        }
        .nav-link:hover {
            color: var(--secondary-gold);
        }
        .program-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .program-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(30, 58, 138, 0.1);
        }
        /* Custom scrollbar for assignment list */
        #assignment-list {
            max-height: 400px;
            overflow-y: auto;
        }
        #assignment-list::-webkit-scrollbar {
            width: 8px;
        }
        #assignment-list::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 4px;
        }
        #assignment-list::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
    </style>
</head>
<body>

    <!-- Header Navigation -->
    <header class="bg-primary-blue shadow-lg fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="#home" class="text-white text-xl font-extrabold tracking-tight">
                        Revelation Bible College <span class="text-xs text-gray-300 align-top">(v1)</span>
                    </a>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="#home" class="nav-link text-white font-medium hover:text-secondary-gold transition duration-150">Home</a>
                    <a href="#about" class="nav-link text-white font-medium hover:text-secondary-gold transition duration-150">About Us</a>
                    <a href="#programs" class="nav-link text-white font-medium hover:text-secondary-gold transition duration-150">Programs</a>
                    <a href="#portal" class="nav-link text-secondary-gold font-bold transition duration-150">Student Portal</a>
                    <a href="#contact" class="nav-link text-white font-medium hover:text-secondary-gold transition duration-150">Contact Us</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="pt-16">

        <!-- Home Section -->
        <section id="home" class="relative overflow-hidden bg-white pt-12 pb-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center pt-16">
                <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-gray-900">
                    Equipping Believers for <span class="text-primary-blue">Meaningful Ministry</span>
                </h1>
                <p class="mt-4 max-w-3xl mx-auto text-xl text-gray-600">
                    A school dedicated to deep biblical exegesis and practical ministry training, empowering the next generation of Christian leaders.
                </p>
                <div class="mt-8 flex justify-center space-x-4">
                    <a href="#programs" class="px-8 py-3 border border-transparent text-base font-medium rounded-full text-white bg-primary-blue hover:bg-opacity-90 shadow-lg transition duration-300 md:py-4 md:text-lg md:px-10">
                        Explore Programs
                    </a>
                    <a href="#contact" class="px-8 py-3 border border-primary-blue text-base font-medium rounded-full text-primary-blue bg-white hover:bg-gray-100 shadow-md transition duration-300 md:py-4 md:text-lg md:px-10">
                        Request Info
                    </a>
                </div>
            </div>
        </section>

        <!-- Programs Overview Section -->
        <section id="programs" class="py-20 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-extrabold text-primary-blue text-center mb-4">Our Programs</h2>
                <p class="text-xl text-gray-600 text-center mb-12 max-w-3xl mx-auto">Theological Depth and Practical Ministry Training</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Program Card 1 -->
                    <div class="program-card bg-white p-6 rounded-xl shadow-xl border-t-4 border-primary-blue">
                        <h3 class="text-2xl font-bold text-primary-blue mb-3">Biblical Studies</h3>
                        <p class="text-gray-700">A focused major on deep exegetical training in both the Old and New Testaments. Students learn original language foundations, historical context, and advanced methods for biblical interpretation and application.</p>
                    </div>

                    <!-- Program Card 2 -->
                    <div class="program-card bg-white p-6 rounded-xl shadow-xl border-t-4 border-primary-blue">
                        <h3 class="text-2xl font-bold text-primary-blue mb-3">Theology and Ministry</h3>
                        <p class="text-gray-700">Prepares future pastors, missionaries, and church leaders through systematic theology, church history, practical preaching, and pastoral care. Includes required field placements in local ministries.</p>
                    </div>

                    <!-- Program Card 3 -->
                    <div class="program-card bg-white p-6 rounded-xl shadow-xl border-t-4 border-primary-blue">
                        <h3 class="text-2xl font-bold text-primary-blue mb-3">Christian Education</h3>
                        <p class="text-gray-700">Designed for those teaching the faith across age groups, from children's ministry to adult discipleship. Focuses on pedagogical theory, curriculum development, and creating effective learning environments.</p>
                    </div>
                </div>

                <div class="text-center mt-12">
                    <button onclick="document.getElementById('contact').scrollIntoView({ behavior: 'smooth' });" class="px-8 py-3 border-4 border-secondary-gold text-lg font-semibold rounded-full text-primary-blue bg-secondary-gold shadow-xl hover:shadow-2xl transition duration-300">
                        Request a Course Guide
                    </button>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2">A Legacy of Biblical Fidelity and Service</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                    <div class="lg:col-span-2 space-y-8">
                        <div>
                            <h3 class="text-3xl font-bold text-primary-blue mb-4">Our History and Vision</h3>
                            <p class="text-lg text-gray-700 leading-relaxed">Revelation Bible College was founded in 1985 with a commitment to inerrancy and the authority of Scripture. What began as a small study group dedicated to deep exegesis has grown into an accredited institution preparing students for ministry worldwide. Our vision is simple: to see every graduate equipped not just with knowledge, but with the wisdom and practical skills needed to lead, preach, and teach God's Word effectively in a complex world. We believe that robust theology must lead to vibrant ministry.</p>
                        </div>
                        <div class="space-y-4">
                            <h3 class="text-3xl font-bold text-primary-blue mb-4">Core Values</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="flex items-start space-x-3">
                                    <i data-lucide="book-open-check" class="w-6 h-6 text-green-600 flex-shrink-0 mt-1"></i>
                                    <div>
                                        <p class="font-semibold text-gray-900">Scriptural Authority:</p>
                                        <p class="text-600 text-sm">The Bible is the final authority in all matters of faith and life.</p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <i data-lucide="hand-heart" class="w-6 h-6 text-yellow-600 flex-shrink-0 mt-1"></i>
                                    <div>
                                        <p class="font-semibold text-gray-900">Servant Leadership:</p>
                                        <p class="text-600 text-sm">Graduates are trained to lead from a posture of humility and service.</p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <i data-lucide="users" class="w-6 h-6 text-indigo-600 flex-shrink-0 mt-1"></i>
                                    <div>
                                        <p class="font-semibold text-gray-900">Community & Discipleship:</p>
                                        <p class="text-600 text-sm">Learning takes place in a context of mutual growth and strong mentorship.</p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <i data-lucide="brain" class="w-6 h-6 text-purple-600 flex-shrink-0 mt-1"></i>
                                    <div>
                                        <p class="font-semibold text-gray-900">Academic Rigor:</p>
                                        <p class="text-600 text-sm">Commitment to excellence in scholarship and critical thinking.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 rounded-xl shadow-xl bg-gray-100 h-fit space-y-8">
                        <div>
                            <h4 class="text-2xl font-bold text-primary-blue flex items-center mb-3">
                                <i data-lucide="shield-check" class="w-6 h-6 mr-2 text-green-500"></i> Accreditation
                            </h4>
                            <p class="text-gray-700">Revelation Bible College is fully accredited by the Association of Theological Schools (ATS) and the Council on Higher Christian Education (CHCE). This ensures our degree programs meet the highest standards of academic quality and theological integrity.</p>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold text-primary-blue flex items-center mb-3">
                                <i data-lucide="map-pin" class="w-6 h-6 mr-2 text-red-500"></i> Location
                            </h4>
                            <p class="text-gray-700">Main Campus: 1400 Gospel Way, City of Refuge, USA</p>
                            <p class="text-gray-700 mt-2 font-medium">Online Programs available globally.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Student Portal Section (Digital Campus) -->
        <section id="portal" class="py-20 bg-primary-blue">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-sm font-semibold tracking-wider text-secondary-gold text-center uppercase mb-2">YOUR DIGITAL CAMPUS</h2>
                <h3 class="text-4xl font-extrabold text-white text-center mb-12">Student Dashboard & Announcements</h3>

                <!-- Portal Content Card -->
                <div class="bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
                    <div id="auth-status" class="text-right text-sm mb-4">
                        <!-- User ID will be injected here -->
                    </div>

                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-4 border-b border-gray-200">
                        <h4 class="text-3xl font-bold text-gray-900">Student Dashboard</h4>
                        <div class="mt-4 md:mt-0 flex space-x-3">
                            <button id="add-task-btn" class="flex items-center space-x-2 px-4 py-2 bg-primary-blue text-white font-medium rounded-lg shadow-md hover:bg-opacity-90 transition duration-150">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i>
                                <span>Add Task</span>
                            </button>
                            <!-- <button class="flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg shadow-md hover:bg-gray-300 transition duration-150">
                                <i data-lucide="settings" class="w-5 h-5"></i>
                                <span>Settings</span>
                            </button> -->
                            <button id="logout-btn" class="flex items-center space-x-2 px-4 py-2 bg-red-500 text-white font-medium rounded-lg shadow-md hover:bg-red-600 transition duration-150">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>

                    <!-- Dashboard Layout -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">

                        <!-- Left Column: Assignments & Quick Resources -->
                        <div class="lg:col-span-2">
                            <h5 class="text-xl font-bold text-primary-blue mb-4 flex items-center">
                                <i data-lucide="clipboard-list" class="w-6 h-6 mr-2"></i> Assignments & Deadlines
                            </h5>
                            <div id="loading-indicator" class="text-center py-8 text-gray-500">
                                <i data-lucide="loader-2" class="w-6 h-6 animate-spin inline-block mr-2"></i>
                                Loading assignments...
                            </div>
                            <div id="assignment-list" class="space-y-4">
                                <!-- Assignments will be injected here by JavaScript -->
                            </div>

                            <h5 class="text-xl font-bold text-primary-blue mb-4 mt-10 flex items-center">
                                <i data-lucide="package" class="w-6 h-6 mr-2"></i> Quick Resources
                            </h5>
                            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                <button class="flex flex-col items-center justify-center p-4 rounded-xl shadow-lg bg-indigo-600 text-white hover:bg-indigo-700 transition duration-150 h-24">
                                    <i data-lucide="bar-chart-3" class="w-6 h-6 mb-1"></i>
                                    <span class="text-sm font-semibold">View Grades</span>
                                </button>
                                <button class="flex flex-col items-center justify-center p-4 rounded-xl shadow-lg bg-emerald-600 text-white hover:bg-emerald-700 transition duration-150 h-24">
                                    <i data-lucide="mail" class="w-6 h-6 mb-1"></i>
                                    <span class="text-sm font-semibold">Email Teacher</span>
                                </button>
                                <button class="flex flex-col items-center justify-center p-4 rounded-xl shadow-lg bg-orange-600 text-white hover:bg-orange-700 transition duration-150 h-24">
                                    <i data-lucide="library" class="w-6 h-6 mb-1"></i>
                                    <span class="text-sm font-semibold">Library Access</span>
                                </button>
                                <button class="flex flex-col items-center justify-center p-4 rounded-xl shadow-lg bg-rose-600 text-white hover:bg-rose-700 transition duration-150 h-24">
                                    <i data-lucide="scroll" class="w-6 h-6 mb-1"></i>
                                    <span class="text-sm font-semibold">Transcript</span>
                                </button>
                            </div>
                        </div>

                        <!-- Right Column: Schedule -->
                        <div class="lg:col-span-1 bg-gray-50 p-6 rounded-xl shadow-inner">
                            <h5 class="text-xl font-bold text-primary-blue mb-4 flex items-center">
                                <i data-lucide="calendar" class="w-6 h-6 mr-2"></i> Today's Schedule
                            </h5>
                            <p class="text-sm text-gray-500 mb-6">Tuesday, November 12</p>

                            <div class="space-y-6">
                                <div class="flex justify-between items-start">
                                    <div class="text-gray-500 text-sm font-medium w-1/4">9:00 AM</div>
                                    <div class="w-3/4">
                                        <p class="font-semibold text-primary-blue">Systematic Theology II</p>
                                        <p class="text-gray-600 text-sm">Room M-201</p>
                                    </div>
                                </div>
                                <div class="flex justify-between items-start">
                                    <div class="text-gray-500 text-sm font-medium w-1/4">10:30 AM</div>
                                    <div class="w-3/4">
                                        <p class="font-semibold text-primary-blue">Old Testament Exegesis</p>
                                        <p class="text-gray-600 text-sm">Room H-105</p>
                                    </div>
                                </div>
                                <div class="flex justify-between items-start">
                                    <div class="text-gray-500 text-sm font-medium w-1/4">12:00 PM</div>
                                    <div class="w-3/4">
                                        <p class="font-semibold text-gray-800">Lunch Break</p>
                                        <p class="text-gray-600 text-sm">Cafeteria</p>
                                    </div>
                                </div>
                                <div class="flex justify-between items-start">
                                    <div class="text-gray-500 text-sm font-medium w-1/4">1:00 PM</div>
                                    <div class="w-3/4">
                                        <p class="font-semibold text-primary-blue">Intro to Homiletics</p>
                                        <p class="text-gray-600 text-sm">Room L-302</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Task Modal (Hidden by default) -->
                <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[100] hidden items-center justify-center">
                    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-2xl font-bold text-primary-blue">Add New Assignment</h4>
                            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                        <form id="add-task-form" class="space-y-4">
                            <div>
                                <label for="task-title" class="block text-sm font-medium text-gray-700">Assignment Title</label>
                                <input type="text" id="task-title" name="title" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-primary-blue focus:border-primary-blue">
                            </div>
                            <div>
                                <label for="task-course" class="block text-sm font-medium text-gray-700">Course Name</label>
                                <input type="text" id="task-course" name="course" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-primary-blue focus:border-primary-blue">
                            </div>
                            <div>
                                <label for="task-due-date" class="block text-sm font-medium text-gray-700">Due Date</label>
                                <input type="date" id="task-due-date" name="dueDate" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-primary-blue focus:border-primary-blue">
                            </div>
                            <button type="submit" id="task-submit-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-blue hover:bg-opacity-90 transition duration-150">
                                Save Assignment
                            </button>
                            <p id="task-message" class="text-center text-sm font-medium hidden"></p>
                        </form>
                    </div>
                </div>

            </div>
        </section>

        <!-- Contact Us Section (UPDATED) -->
        <section id="contact" class="py-20 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-extrabold text-primary-blue mb-4">Get in Touch with Admissions</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">We're ready to answer your questions and guide you through your journey to ministry training.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 bg-white rounded-xl shadow-2xl p-6 md:p-10 border-t-4 border-secondary-gold">
                    <!-- Left Column: Contact Details & Info -->
                    <div class="lg:col-span-1 space-y-8 pr-0 lg:pr-8 border-b lg:border-b-0 lg:border-r border-gray-200 pb-8 lg:pb-0">
                        <h4 class="text-2xl font-bold text-gray-900 mb-4">Contact Information</h4>
                        
                        <!-- Phone -->
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0 p-3 rounded-full bg-primary-blue text-white">
                                <i data-lucide="phone" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-gray-900">Admissions Office</p>
                                <p class="text-primary-blue text-xl font-bold">(555) 732-2432</p>
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0 p-3 rounded-full bg-primary-blue text-white">
                                <i data-lucide="mail" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-gray-900">General Inquiries</p>
                                <p class="text-primary-blue text-xl font-bold">admissions@rbc.edu</p>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0 p-3 rounded-full bg-primary-blue text-white">
                                <i data-lucide="map-pin" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-gray-900">Campus Location</p>
                                <p class="text-gray-700">1400 Gospel Way, City of Refuge, USA</p>
                            </div>
                        </div>

                        <div class="pt-4">
                            <p class="text-sm text-gray-500">Office Hours: Mon - Fri, 9:00 AM - 5:00 PM (PST)</p>
                        </div>
                    </div>

                    <!-- Right Column: Contact Form -->
                    <div class="lg:col-span-2">
                        <h4 class="text-2xl font-bold text-primary-blue mb-6">Send Us a Message</h4>
                        <form id="contact-form" class="space-y-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Name -->
                                <div>
                                    <label for="contact-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text" id="contact-name" name="name" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-secondary-gold focus:border-secondary-gold">
                                </div>
                                <!-- Email -->
                                <div>
                                    <label for="contact-email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <input type="email" id="contact-email" name="email" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-secondary-gold focus:border-secondary-gold">
                                </div>
                            </div>
                            
                            <!-- Subject/Inquiry Type -->
                            <div>
                                <label for="contact-subject" class="block text-sm font-medium text-gray-700">Subject of Inquiry</label>
                                <select id="contact-subject" name="subject" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-secondary-gold focus:border-secondary-gold bg-white">
                                    <option value="">-- Select One --</option>
                                    <option value="Admissions">Admissions & Application</option>
                                    <option value="Financial Aid">Financial Aid & Scholarships</option>
                                    <option value="Program Details">Program Details & Curriculum</option>
                                    <option value="Other">General Question / Other</option>
                                </select>
                            </div>

                            <!-- Message -->
                            <div>
                                <label for="contact-message" class="block text-sm font-medium text-gray-700">Your Message</label>
                                <textarea id="contact-message" name="message" rows="5" required class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-secondary-gold focus:border-secondary-gold"></textarea>
                            </div>
                            
                            <!-- Submit Button -->
                            <button type="submit" id="contact-submit-btn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-primary-blue bg-secondary-gold hover:bg-opacity-90 transition duration-150 transform hover:scale-[1.01]">
                                Send Message
                            </button>
                            <p id="contact-message-status" class="text-center text-sm font-medium mt-4 hidden"></p>
                        </form>
                    </div>
                </div>
            </div>
        </section>


    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 Revelation Bible College. All rights reserved.</p>
            <div class="mt-4 flex justify-center space-x-4">
                <a href="#" class="text-gray-400 hover:text-white transition duration-150">Privacy Policy</a>
                <span class="text-gray-500">|</span>
                <a href="#" class="text-gray-400 hover:text-white transition duration-150">Terms of Use</a>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK Imports and Logic -->
    <script type="module">
        // Global variables for Firebase configuration, provided by the Canvas environment.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, addDoc, deleteDoc, setLogLevel, getDocs, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let app;
        let db;
        let auth;
        let userId = 'loading...';

        // Helper function for exponential backoff (retry logic for API calls)
        const withExponentialBackoff = async (fn, maxRetries = 5, delay = 1000) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await fn();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        };

        const setupFirebase = async () => {
            if (!firebaseConfig) {
                console.error("FIREBASE ERROR: Configuration missing.");
                document.getElementById('loading-indicator').innerHTML = `<p class="text-red-500 font-bold">Error: Firebase Configuration Missing.</p>`;
                return;
            }

            try {
                // Set debug logging for development
                setLogLevel('error');
                
                // 1. Initialize Firebase
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // 2. Set up Auth Listener
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("User authenticated:", userId);
                        document.getElementById('auth-status').innerHTML = `
                            <span class="text-gray-500">Authenticated User ID:</span>
                            <span class="font-mono font-semibold text-primary-blue">${userId}</span>
                        `;
                        // Start listening to assignments only after auth is ready
                        loadAssignments(userId);
                    } else {
                        userId = null;
                        console.log("No user signed in. Attempting sign-in...");
                        document.getElementById('auth-status').innerHTML = `
                            <span class="text-red-500 font-medium">Authentication Failed. Please refresh.</span>
                        `;
                    }
                });

                // 3. Attempt Sign-in
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("FIREBASE SETUP FAILED:", error);
                document.getElementById('loading-indicator').innerHTML = `<p class="text-red-500 font-bold">Error: Failed to initialize or authenticate. Check console for details.</p>`;
            }
        };

        // --- Assignment Management (Private Data) ---

        const loadAssignments = (currentUserId) => {
            if (!db || !currentUserId) return;

            const assignmentsRef = collection(db, 'artifacts', appId, 'users', currentUserId, 'assignments');
            const q = query(assignmentsRef);

            // Hide loading, show list
            document.getElementById('loading-indicator').classList.add('hidden');
            document.getElementById('assignment-list').innerHTML = ''; // Clear previous list

            onSnapshot(q, (snapshot) => {
                const listContainer = document.getElementById('assignment-list');
                listContainer.innerHTML = '';
                const assignments = [];

                snapshot.forEach(doc => {
                    assignments.push({ id: doc.id, ...doc.data() });
                });

                if (assignments.length === 0) {
                    listContainer.innerHTML = `
                        <div class="text-center py-6 text-gray-500 border border-dashed border-gray-300 rounded-xl">
                            <i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2"></i>
                            <p class="font-medium">No assignments scheduled!</p>
                            <p class="text-sm">Click 'Add Task' to get started.</p>
                        </div>
                    `;
                    // Re-render lucide icons after injecting HTML
                    lucide.createIcons();
                    return;
                }

                // Sort by due date (in-memory to avoid Firestore index issues)
                assignments.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                assignments.forEach(assignment => {
                    const isCompleted = assignment.completed;
                    const dueDate = new Date(assignment.dueDate);
                    const formattedDate = dueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const isOverdue = dueDate < today && !isCompleted;
                    const statusClass = isCompleted ? 'bg-green-100 border-green-400' : (isOverdue ? 'bg-red-100 border-red-400' : 'bg-blue-50 border-blue-400');
                    const statusText = isCompleted ? 'Completed' : (isOverdue ? 'Overdue' : 'Due');
                    const statusIcon = isCompleted ? 'check-circle' : (isOverdue ? 'alert-triangle' : 'clock');

                    const itemHtml = `
                        <div class="flex items-center p-4 rounded-xl shadow-md ${statusClass} border-l-8 transition duration-200 hover:shadow-lg">
                            <input type="checkbox" id="task-${assignment.id}" data-id="${assignment.id}" class="h-5 w-5 rounded text-primary-blue border-gray-300 focus:ring-primary-blue" ${isCompleted ? 'checked' : ''} onchange="toggleCompletion('${assignment.id}', event.target.checked)">
                            <div class="ml-4 flex-1">
                                <label for="task-${assignment.id}" class="text-lg font-semibold ${isCompleted ? 'line-through text-gray-500' : 'text-gray-900'}">${assignment.title}</label>
                                <p class="text-sm ${isCompleted ? 'text-gray-400' : 'text-gray-600'}">${assignment.course}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-medium px-2 py-1 rounded-full flex items-center mb-1 ${isCompleted ? 'bg-green-500 text-white' : (isOverdue ? 'bg-red-500 text-white' : 'bg-primary-blue text-white')}">
                                    <i data-lucide="${statusIcon}" class="w-4 h-4 mr-1"></i> ${statusText}
                                </span>
                                <p class="text-sm font-bold text-gray-700 mt-1">Due: ${formattedDate}</p>
                            </div>
                            <button onclick="deleteAssignment('${assignment.id}')" class="ml-4 text-gray-400 hover:text-red-500 transition duration-150">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    `;
                    listContainer.insertAdjacentHTML('beforeend', itemHtml);
                });
                // Re-render lucide icons after injecting HTML
                lucide.createIcons();
            }, (error) => {
                console.error("Error loading assignments:", error);
                document.getElementById('assignment-list').innerHTML = `<p class="text-red-500 text-center">Failed to load assignments. Please check connectivity.</p>`;
            });
        };

        window.toggleCompletion = async (assignmentId, completedStatus) => {
            if (!db || !userId) return;
            const assignmentDocRef = doc(db, 'artifacts', appId, 'users', userId, 'assignments', assignmentId);
            try {
                await withExponentialBackoff(() => setDoc(assignmentDocRef, { completed: completedStatus }, { merge: true }));
                console.log(`Assignment ${assignmentId} completion status set to ${completedStatus}`);
            } catch (e) {
                console.error("Error toggling assignment completion:", e);
                // Revert checkbox state if update fails
                document.getElementById(`task-${assignmentId}`).checked = !completedStatus;
            }
        };

        window.deleteAssignment = async (assignmentId) => {
            if (!db || !userId) return;
            // Use a custom UI alert instead of window.confirm()
            if (!confirmAction("Are you sure you want to delete this assignment?")) return;

            const assignmentDocRef = doc(db, 'artifacts', appId, 'users', userId, 'assignments', assignmentId);
            try {
                await withExponentialBackoff(() => deleteDoc(assignmentDocRef));
                console.log(`Assignment ${assignmentId} deleted.`);
            } catch (e) {
                console.error("Error deleting assignment:", e);
            }
        };

        // --- Contact Form Submission (Public Data) ---

        const submitContactForm = async (e) => {
            e.preventDefault();
            const form = e.target;
            const statusMessage = document.getElementById('contact-message-status');
            const submitBtn = document.getElementById('contact-submit-btn');

            if (!db) {
                statusMessage.textContent = "Error: Database not initialized.";
                statusMessage.className = 'text-center text-red-500 mt-4';
                statusMessage.classList.remove('hidden');
                return;
            }

            submitBtn.textContent = 'Sending...';
            submitBtn.disabled = true;
            statusMessage.classList.add('hidden');

            const submissionData = {
                name: form.elements['name'].value,
                email: form.elements['email'].value,
                subject: form.elements['subject'].value, // New field
                message: form.elements['message'].value,
                timestamp: new Date().toISOString()
            };

            try {
                const contactRef = collection(db, 'artifacts', appId, 'public', 'data', 'contact_submissions');
                await withExponentialBackoff(() => addDoc(contactRef, submissionData));

                statusMessage.textContent = 'Thank you! Your inquiry has been sent to our admissions team.';
                statusMessage.className = 'text-center text-green-600 font-bold mt-4';
                statusMessage.classList.remove('hidden');
                form.reset();

            } catch (error) {
                console.error("Error submitting contact form:", error);
                statusMessage.textContent = 'Error: Failed to send message. Please try again.';
                statusMessage.className = 'text-center text-red-500 font-bold mt-4';
                statusMessage.classList.remove('hidden');
            } finally {
                submitBtn.textContent = 'Send Message';
                submitBtn.disabled = false;
            }
        };

        // --- Custom UI Confirmation ---
        // A minimal, non-blocking replacement for window.confirm()
        const confirmAction = (message) => {
            return window.prompt(`Please type "YES" to confirm: ${message}`) === "YES";
        }


        // --- Event Listeners and Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initial call to create Lucide icons
            lucide.createIcons();
            
            // Initialize Firebase and Auth State
            setupFirebase();

            // Contact Form Listener
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', submitContactForm);
            }

            // Task Modal Listeners
            const taskModal = document.getElementById('task-modal');
            const addTaskBtn = document.getElementById('add-task-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const addTaskForm = document.getElementById('add-task-form');
            const taskSubmitBtn = document.getElementById('task-submit-btn');
            const taskMessage = document.getElementById('task-message');

            if (addTaskBtn) {
                addTaskBtn.addEventListener('click', () => {
                    taskModal.classList.remove('hidden');
                    taskModal.classList.add('flex');
                    taskMessage.classList.add('hidden');
                    addTaskForm.reset();
                });
            }

            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => {
                    taskModal.classList.remove('flex');
                    taskModal.classList.add('hidden');
                });
            }

            if (taskModal) {
                taskModal.addEventListener('click', (e) => {
                    if (e.target === taskModal) {
                        taskModal.classList.remove('flex');
                        taskModal.classList.add('hidden');
                    }
                });
            }

            if (addTaskForm) {
                addTaskForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!db || !userId) {
                        taskMessage.textContent = "Error: Authentication required.";
                        taskMessage.className = 'text-center text-red-500 mt-4';
                        taskMessage.classList.remove('hidden');
                        return;
                    }

                    taskSubmitBtn.textContent = 'Saving...';
                    taskSubmitBtn.disabled = true;

                    const newTask = {
                        title: document.getElementById('task-title').value,
                        course: document.getElementById('task-course').value,
                        dueDate: document.getElementById('task-due-date').value,
                        completed: false,
                        created: new Date().toISOString()
                    };

                    try {
                        const assignmentsRef = collection(db, 'artifacts', appId, 'users', userId, 'assignments');
                        await withExponentialBackoff(() => addDoc(assignmentsRef, newTask));

                        taskMessage.textContent = 'Assignment saved successfully!';
                        taskMessage.className = 'text-center text-green-600 font-bold mt-4';
                        taskMessage.classList.remove('hidden');
                        addTaskForm.reset();

                        // Hide modal after a short delay
                        setTimeout(() => {
                            taskModal.classList.remove('flex');
                            taskModal.classList.add('hidden');
                        }, 1000);

                    } catch (error) {
                        console.error("Error adding assignment:", error);
                        taskMessage.textContent = 'Error: Failed to save assignment.';
                        taskMessage.className = 'text-center text-red-500 font-bold mt-4';
                        taskMessage.classList.remove('hidden');
                    } finally {
                        taskSubmitBtn.textContent = 'Save Assignment';
                        taskSubmitBtn.disabled = false;
                    }
                });
            }

            // Logout Button Listener
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        if (confirmAction("Are you sure you want to sign out?")) {
                            await signOut(auth);
                            window.location.reload(); // Simple refresh to re-init as anonymous
                        }
                    } catch (error) {
                        console.error("Logout failed:", error);
                    }
                });
            }
        });
    </script>

</body>
</html>